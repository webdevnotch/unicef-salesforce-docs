import{_ as s,c as a,o as n,a as e}from"./app.5dbd4e2d.js";const u=JSON.parse('{"title":"How to Test Cron Job Persistence","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u{1F9EA} Quick Test","slug":"\u{1F9EA}-quick-test","link":"#\u{1F9EA}-quick-test","children":[]},{"level":2,"title":"Step 1: Start Server","slug":"step-1-start-server","link":"#step-1-start-server","children":[]},{"level":2,"title":"Step 2: Disable a Job","slug":"step-2-disable-a-job","link":"#step-2-disable-a-job","children":[]},{"level":2,"title":"Step 3: Verify in Database","slug":"step-3-verify-in-database","link":"#step-3-verify-in-database","children":[]},{"level":2,"title":"Step 4: Restart Server","slug":"step-4-restart-server","link":"#step-4-restart-server","children":[]},{"level":2,"title":"Step 5: Check State After Restart","slug":"step-5-check-state-after-restart","link":"#step-5-check-state-after-restart","children":[]},{"level":2,"title":"Step 6: Verify Jobs Skip","slug":"step-6-verify-jobs-skip","link":"#step-6-verify-jobs-skip","children":[]},{"level":2,"title":"Step 7: Re-enable","slug":"step-7-re-enable","link":"#step-7-re-enable","children":[]},{"level":2,"title":"\u{1F389} Success!","slug":"\u{1F389}-success","link":"#\u{1F389}-success","children":[]}],"relativePath":"backend/TEST_PERSISTENCE.md"}'),l={name:"backend/TEST_PERSISTENCE.md"},p=e(`<h1 id="how-to-test-cron-job-persistence" tabindex="-1">How to Test Cron Job Persistence <a class="header-anchor" href="#how-to-test-cron-job-persistence" aria-hidden="true">#</a></h1><h2 id="\u{1F9EA}-quick-test" tabindex="-1">\u{1F9EA} Quick Test <a class="header-anchor" href="#\u{1F9EA}-quick-test" aria-hidden="true">#</a></h2><p>Test that your cron job settings persist across server restarts!</p><hr><h2 id="step-1-start-server" tabindex="-1">Step 1: Start Server <a class="header-anchor" href="#step-1-start-server" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">npm run start:dev</span></span>
<span class="line"></span></code></pre></div><p>Look for initialization log:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">[CronJobStateService] Initialized default cron job settings in database</span></span>
<span class="line"><span style="color:#A6ACCD;">[CronJobStateService] Loaded 4 cron job states from database</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><hr><h2 id="step-2-disable-a-job" tabindex="-1">Step 2: Disable a Job <a class="header-anchor" href="#step-2-disable-a-job" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># Get JWT token</span></span>
<span class="line"><span style="color:#A6ACCD;">TOKEN=</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">curl -X POST http://localhost:3000/auth/login \\</span></span>
<span class="line"><span style="color:#C3E88D;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Type: application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">  -d </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;email&quot;:&quot;admin@example.com&quot;,&quot;password&quot;:&quot;yourpassword&quot;}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;"> jq -r </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.access_token</span><span style="color:#89DDFF;">&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Disable pledge jobs</span></span>
<span class="line"><span style="color:#A6ACCD;">curl -X PUT http://localhost:3000/cron-jobs/pledge/toggle \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Authorization: Bearer </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">TOKEN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Type: application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -d </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;enabled&quot;: false}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p><strong>Response:</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">success</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cron job pledge disabled</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">jobType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pledge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">enabled</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><hr><h2 id="step-3-verify-in-database" tabindex="-1">Step 3: Verify in Database <a class="header-anchor" href="#step-3-verify-in-database" aria-hidden="true">#</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SystemSetting</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> category </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cronJobs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>You should see:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">key       | value</span></span>
<span class="line"><span style="color:#A6ACCD;">----------|-------</span></span>
<span class="line"><span style="color:#A6ACCD;">pledge    | false  \u2190 Disabled!</span></span>
<span class="line"><span style="color:#A6ACCD;">oneoff    | true</span></span>
<span class="line"><span style="color:#A6ACCD;">recurring | true</span></span>
<span class="line"><span style="color:#A6ACCD;">hourly    | true</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><hr><h2 id="step-4-restart-server" tabindex="-1">Step 4: Restart Server <a class="header-anchor" href="#step-4-restart-server" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># Stop server (Ctrl+C)</span></span>
<span class="line"><span style="color:#676E95;"># Start again</span></span>
<span class="line"><span style="color:#A6ACCD;">npm run start:dev</span></span>
<span class="line"></span></code></pre></div><p>Look for:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">[CronJobStateService] Loaded 4 cron job states from database</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><hr><h2 id="step-5-check-state-after-restart" tabindex="-1">Step 5: Check State After Restart <a class="header-anchor" href="#step-5-check-state-after-restart" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">curl -X GET http://localhost:3000/cron-jobs/pledge/state \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Authorization: Bearer </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">TOKEN</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p><strong>Response:</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">jobType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pledge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">enabled</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">  \u2190 Still disabled!</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u2705 <strong>Success!</strong> Your setting survived the restart!</p><hr><h2 id="step-6-verify-jobs-skip" tabindex="-1">Step 6: Verify Jobs Skip <a class="header-anchor" href="#step-6-verify-jobs-skip" aria-hidden="true">#</a></h2><p>Watch the logs. You should see:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">Pledge jobs are disabled, skipping...</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>No pledge jobs will execute because they&#39;re disabled.</p><hr><h2 id="step-7-re-enable" tabindex="-1">Step 7: Re-enable <a class="header-anchor" href="#step-7-re-enable" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">curl -X PUT http://localhost:3000/cron-jobs/pledge/toggle \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Authorization: Bearer </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">TOKEN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -H </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Type: application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -d </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;enabled&quot;: true}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>Now you should see:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">Scheduling pledge jobs...</span></span>
<span class="line"><span style="color:#A6ACCD;">Scheduled pledge jobs successfully...</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><hr><h2 id="\u{1F389}-success" tabindex="-1">\u{1F389} Success! <a class="header-anchor" href="#\u{1F389}-success" aria-hidden="true">#</a></h2><p>Your cron job persistence is working! Settings are:</p><ul><li>\u2705 Stored in database</li><li>\u2705 Loaded on startup</li><li>\u2705 Survive restarts</li><li>\u2705 Work in real-time</li></ul><hr>`,44),o=[p];function t(r,c,i,D,y,d){return n(),a("div",null,o)}const h=s(l,[["render",t]]);export{u as __pageData,h as default};
